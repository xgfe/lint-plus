/*
 * angular-ui-fugu
 * Version: 0.1.0 - 2016-05-09
 * License: ISC
 */
angular.module("ui.fugu",["ui.fugu.tpls","ui.fugu.modal"]),angular.module("ui.fugu.tpls",["modal/templates/backdrop.html","modal/templates/window.html"]),angular.module("ui.fugu.modal",[]).factory("$transition",function(){function e(e){for(var n in e)if(!angular.isUndefined(t.style[n]))return e[n]}var n={},t=document.createElement("trans"),a={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",transition:"transitionend"},o={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",transition:"animationend"};return n.transitionEndEventName=e(a),n.animationEndEventName=e(o),n}).factory("$$stackedMap",function(){return{createNew:function(){var e=[];return{add:function(n,t){e.push({key:n,value:t})},get:function(n){for(var t=0;t<e.length;t++)if(n==e[t].key)return e[t]},keys:function(){for(var n=[],t=0;t<e.length;t++)n.push(e[t].key);return n},top:function(){return e[e.length-1]},remove:function(n){for(var t=-1,a=0;a<e.length;a++)if(n==e[a].key){t=a;break}return e.splice(t,1)[0]},removeTop:function(){return e.splice(e.length-1,1)[0]},length:function(){return e.length}}}}}).directive("fuguModalBackdrop",["$timeout",function(e){return{restrict:"EA",replace:!0,templateUrl:"templates/backdrop.html",link:function(n,t,a){n.backdropClass=a.backdropClass||"",n.animate=!1,e(function(){n.animate=!0})}}}]).directive("fuguModalWindow",["$fgModalStack","$timeout",function(e,n){return{restrict:"EA",scope:{index:"@",animate:"="},replace:!0,transclude:!0,templateUrl:"templates/window.html",link:function(t,a,o){a.addClass(o.windowClass||""),t.size=o.size,n(function(){t.animate=!0,a[0].querySelectorAll("[autofocus]").length||a[0].focus()}),t.close=function(n){var t=e.getTop();t&&t.value.backdrop&&"static"!=t.value.backdrop&&n.target===n.currentTarget&&(n.preventDefault(),n.stopPropagation(),e.dismiss(t.key,"backdrop click"))}}}}]).directive("fuguModalTransclude",function(){return{link:function(e,n,t,a,o){o(e.$parent,function(e){n.empty(),n.append(e)})}}}).factory("$fgModalStack",["$transition","$timeout","$document","$compile","$rootScope","$$stackedMap",function(e,n,t,a,o,i){function r(){for(var e=-1,n=f.keys(),t=0;t<n.length;t++)f.get(n[t]).value.backdrop&&(e=t);return e}function l(e){var n=t.find("body").eq(0),a=f.get(e).value;f.remove(e),d(a.modalDomEl,a.modalScope,300,function(){a.modalScope.$destroy(),n.toggleClass(p,f.length()>0),s()})}function s(){if(c&&-1==r()){var e=u;d(c,u,150,function(){e.$destroy(),e=null}),c=null,u=null}}function d(t,a,o,i){function r(){r.done||(r.done=!0,t.remove(),i&&i())}a.animate=!1;var l=e.transitionEndEventName;if(l){var s=n(r,o);t.bind(l,function(){n.cancel(s),r(),a.$apply()})}else n(r)}var c,u,p="modal-open",f=i.createNew(),m={};return o.$watch(r,function(e){u&&(u.index=e)}),t.bind("keydown",function(e){var n;27===e.which&&(n=f.top(),n&&n.value.keyboard&&(e.preventDefault(),o.$apply(function(){m.dismiss(n.key,"escape key press")})))}),m.open=function(e,n){f.add(e,{deferred:n.deferred,modalScope:n.scope,backdrop:n.backdrop,keyboard:n.keyboard});var i=t.find("body").eq(0),l=r();if(l>=0&&!c){u=o.$new(!0),u.index=l;var s=angular.element("<div fugu-modal-backdrop></div>");s.attr("backdrop-class",n.backdropClass),c=a(s)(u),i.append(c)}var d=angular.element("<div fugu-modal-window></div>");d.attr({"window-class":n.windowClass,size:n.size,index:f.length()-1,animate:"animate"}).html(n.content);var m=a(d)(n.scope);f.top().value.modalDomEl=m,i.append(m),i.addClass(p)},m.close=function(e,n){var t=f.get(e);t&&(t.value.deferred.resolve(n),l(e))},m.dismiss=function(e,n){var t=f.get(e);t&&(t.value.deferred.reject(n),l(e))},m.dismissAll=function(e){for(var n=this.getTop();n;)this.dismiss(n.key,e),n=this.getTop()},m.getTop=function(){return f.top()},m}]).provider("$fgModal",function(){var e=this;this.options={backdrop:!0,keyboard:!0},this.$get=["$injector","$rootScope","$q","$http","$templateCache","$controller","$fgModalStack",function(n,t,a,o,i,r,l){function s(e){return e.template?a.when(e.template):o.get(angular.isFunction(e.templateUrl)?e.templateUrl():e.templateUrl,{cache:i}).then(function(e){return e.data})}function d(e){var t=[];return angular.forEach(e,function(e){(angular.isFunction(e)||angular.isArray(e))&&t.push(a.when(n.invoke(e)))}),t}return{open:function(n){var o=a.defer(),i=a.defer(),c={result:o.promise,opened:i.promise,close:function(e){l.close(c,e)},dismiss:function(e){l.dismiss(c,e)}};if(n=angular.extend({},e.options,n),n.resolve=n.resolve||{},!n.template&&!n.templateUrl)throw new Error("One of template or templateUrl options is required.");var u=a.all([s(n)].concat(d(n.resolve)));return u.then(function(e){var a=(n.scope||t).$new();a.$close=c.close,a.$dismiss=c.dismiss;var i,s={},d=1;n.controller&&(s.$scope=a,s.$fgModalInstance=c,angular.forEach(n.resolve,function(n,t){s[t]=e[d++]}),i=r(n.controller,s),n.controllerAs&&(a[n.controllerAs]=i)),l.open(c,{scope:a,deferred:o,content:e[0],backdrop:n.backdrop,keyboard:n.keyboard,backdropClass:n.backdropClass,windowClass:n.windowClass,size:n.size})},function(e){o.reject(e)}),u.then(function(){i.resolve(!0)},function(){i.reject(!1)}),c}}}]}),angular.module("modal/templates/backdrop.html",[]).run(["$templateCache",function(e){e.put("templates/backdrop.html",'<div class="modal-backdrop fade {{ backdropClass }}"     ng-class="{in: animate}"     ng-style="{\'z-index\': 1040 + (index && 1 || 0) + index*10}"></div>')}]),angular.module("modal/templates/window.html",[]).run(["$templateCache",function(e){e.put("templates/window.html",'<div tabindex="-1" role="dialog" class="modal fade" ng-class="{in: animate}" ng-style="{\'z-index\': 1050 + index*10, display: \'block\'}" ng-click="close($event)">    <div class="modal-dialog" ng-class="{\'modal-sm\': size == \'sm\', \'modal-lg\': size == \'lg\'}">        <div class="modal-content" fugu-modal-transclude></div>    </div></div>')}]);